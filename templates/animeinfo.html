{% extends "layout.html" %}

{% block title %}
    {{data['title']['romaji']}}
{% endblock %}

{%block header%}
<header class="backgroundinfo" style="background-image: url('{{banner}}');">
    <div class="shadow"></div>
</header>
<div class="header animeinfoheader">
    <nav class="navbar navbar-expand-lg navbar-dark prueba">
        <a class="logoat navbar-brand logo" href="/">AT</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-item nav-link active" href="/seasons">Seasons<span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link" href="/schedule">Schedule</a>
            <a class="nav-item nav-link" href="/anime">Search Anime</a>
            <a class="nav-item nav-link push" href="#">About</a>
            <form action="/anime" method="get" class="searchanime push" id="globalsearch"">
              <input type="text" name="title" autocomplete="off" placeholder="Anime">
              <button type="submit">Search</button>
            </form>
          </div>
        </div>
      </nav>
</div>
{%endblock%}

{% block main %}

    <div class="animeinfo-container">
        <div class="animeinfo-content leftco">
            <div class="animecoverimage">
                <img src="{{data['coverImage']['extraLarge']}}" alt="Cover image of anime {{data['title']['romaji']}}">
            </div>
            
            <section class="specification section-part">
                <div class="animeinfospecs"> 
                    <span class="darkspan">Japanese title: </span>
                    {{data['title']['native']}}
                </div>
                <div class="animeinfospecs"> 
                    {% if data['type'] == 'MANGA' %}
                        <span class="darkspan">Chapters: </span>
                        {% if data['chapters']  %}
                            {{ data['chapters'] }}
                        {%else%}
                            No info
                        {%endif%} 
                    {% else %}
                        <span class="darkspan">Episodes: </span>
                        {% if data['episodes']  %}
                            {{ data['episodes'] }}
                        {%else%}
                            No info
                        {%endif%}
                    {% endif %}
                </div>
                <div class="animeinfospecs"> 
                    <span class="darkspan">Started airing: </span>
                    {% if data['startDate']['day'] is none and data['startDate']['month'] is none and data['startDate']['year'] is none%}
                        No info
                    {%else%}
                        {{data['startDate']['day']}}-{{data['startDate']['month']}}-{{data['startDate']['year']}}
                        {%endif%}
                </div>
                <div class="animeinfospecs"> 
                    <span class="darkspan">Ended airing: </span>
                    {% if not data['endDate']['day'] or not data['endDate']['month'] or not data['endDate']['year']%}
                        No info
                    {% else %}
                        {{data['endDate']['day']}}-{{data['startDate']['month']}}-{{data['endDate']['year']}}
                    {% endif %}
                </div>
                <div class="animeinfospecs"> 
                    {% if data['type'] == 'ANIME' %}     
                            <span class="darkspan">Studio: </span>
                            {{data['studios']['edges'][0]['node']['name']}}
                    {% endif %}
                </div>
                <div class="animeinfospecs"> 
                    <span class="darkspan">Source: </span>
                    {{data['source']}}
                </div>
                
            </section>
            {% if data['type'] == 'ANIME' and data['status'] =='RELEASING'%} 
                <section>
                    <span class="darkspan">Schedule</span>
                    <button class="addbutton addbutton-animeinfo"  data-anime-id="{{ data['id'] }}"></button>
                </section>
            {% endif %}
        </div>
        <div class="animeinfo-content middleco">
            <section class="animetitles section-content">
                <h1>{{data['title']['romaji']}}</h2>
                <h5>{{data['title']['english']}}</h2>
            </section>
            <section class="animeinfodescription section-content">
                <p>{{data['description'] | safe}}</p>
            </section>
            <section class="genre-season section-content ">
                <div class="fixanimegenre">
                    <h4>Genres</h4>
                    <div class="animegenres section-part">
                        {% for genre in data['genres'] %}
                        <a href="/anime?selectgenre={{genre}}">
                            <div class="tag-div">
                                <span class="tag-content purple">{{genre}}</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                <div class="animeseason section-part">
                    <h4>Season</h4>
                    {% if data['season'] is none or data['seasonYear'] is none %}
                    <div class="tag-div">
                        <span class="tag-content blue">NO INFO</span>
                    </div>
                    {%else%}
                        <a href="/{{data['season'].lower()}}/{{data['seasonYear']}}">
                            <div class="tag-div">
                                <span class="tag-content blue">{{data['season']}} {{data['seasonYear']}}</span>
                            </div>
                        </a>
                    {%endif%}
                </div>
                <div class="animetype section-part">
                    <h4>Type</h4>
                    <div class="tag-div">
                        <span class="tag-content">{{data['type']}}</span>
                    </div>
                </div>
                <div class="animeformat section-part">
                    <h4>Format</h4>
                    <div class="tag-div">
                        {% if not data['format'] %}
                            <span class="tag-content">NO INFO</span>
                        {% else %}
                            <span class="tag-content">{{data['format']}}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="animestatus section-part">
                    <h4>Status</h4>
                    <div class="tag-div">
                        {% if data['status'] == 'FINISHED' %}
                            <span class="tag-content red">{{data['status']}}</span>
                        {% else %}
                            <span class="tag-content green">{{data['status']}}</span>
                        {% endif %}
                    </div>
                </div>
            </section>
            <section class="avgpopularity section-part centercontent">
                <div class="popularity">
                    <h4>Popularity</h4>
                    <div class="tag-div">
                        <span class="tag-content">{{data['popularity']}}</span> 
                    </div>
                </div>
                <div class="score">
                    <h4>Score</h4>
                    {% if data['averageScore'] is not none %}
                    <div class="tag-div">
                        <span class="tag-content">{{data['averageScore']/10}}</span>
                    </div>
                    {%else%}
                    <div class="tag-div">
                        <span class="tag-content">NO INFO</span>
                    </div>
                    {% endif %}
                </div>
            </section>
        </div>
        <div class="animeinfo-content rightco">
            <h3>Relations</h3>
            {% for anime in data['relations']['edges'] %}
                {% if loop.index <= 4 %}
                <a href="{{ anime['node']['id'] }}"> 
                    <div class="relationanime">
                        <div class="relationimage">
                            <img src="{{anime['node']['coverImage']['medium']}}" alt="image of {{anime['node']['title']['romaji']}}">
                        </div>
                        <div class="relationinfo">
                            <h6>{{anime['node']['title']['romaji']}}</h6>
                            {% if anime['node']['format'] == 'MANGA' %}
                                {% if anime['node']['chapters'] is not none %}
                                    <span>{{ anime['node']['chapters'] }} chapters</span>
                                {% endif %}
                            {% else %}
                                {% if anime['node']['episodes'] is not none %}
                                    <span>{{ anime['node']['episodes'] }} episodes</span>
                                {% endif %}
                            {% endif %}
                            <hr>
                            <span>{{anime['node']['format']}}</span>
                        </div>
                    </div>
                </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
{% endblock %}